# Migration `20201017033209-init-push-db`

This migration has been generated by 권수현 at 10/17/2020, 12:32:09 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `Profile` (
`id` int  NOT NULL  AUTO_INCREMENT,
`socialId` varchar(191)  ,
`authType` ENUM('email', 'google', 'apple')  ,
`userId` int  NOT NULL ,
UNIQUE INDEX `Profile.userId_unique`(`userId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `User` (
`id` int  NOT NULL  AUTO_INCREMENT,
`email` varchar(191)  ,
`password` varchar(191)  ,
`name` varchar(191)  ,
`photoURL` varchar(191)  ,
`birthday` datetime(3)  ,
`gender` ENUM('male', 'female')  ,
`createdAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`deletedAt` datetime(3)  ,
`lastSignedIn` datetime(3)  ,
UNIQUE INDEX `User.email_unique`(`email`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `WorkOut` (
`id` int  NOT NULL  AUTO_INCREMENT,
`name` varchar(191)  ,
`workOutType` ENUM('workout')  ,
`reps` int  ,
`time` int  ,
`set` int  ,
`rest` int  ,
`createdAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`deletedAt` datetime(3)  ,
`userId` int  NOT NULL ,
UNIQUE INDEX `WorkOut.userId_unique`(`userId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Mission` (
`id` int  NOT NULL  AUTO_INCREMENT,
`createdAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`missionType` ENUM('workout')  NOT NULL ,
`workOutId` int  ,
`userId` int  NOT NULL ,
UNIQUE INDEX `Mission.workOutId_unique`(`workOutId`),
UNIQUE INDEX `Mission.userId_unique`(`userId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `WeeklyCount` (
`userId` int  NOT NULL ,
`createdAt` datetime(3)  ,
`count` int  NOT NULL ,
UNIQUE INDEX `WeeklyCount.userId_unique`(`userId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `TotalCount` (
`userId` int  NOT NULL ,
`createdAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`deletedAt` datetime(3)  ,
`count` int  NOT NULL ,
UNIQUE INDEX `TotalCount.userId_unique`(`userId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `WeeklyAccTime` (
`userId` int  NOT NULL ,
`createdAt` datetime(3)  ,
`accTime` int  NOT NULL ,
UNIQUE INDEX `WeeklyAccTime.userId_unique`(`userId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `TotalAccTime` (
`userId` int  NOT NULL ,
`createdAt` datetime(3)  DEFAULT CURRENT_TIMESTAMP(3),
`deletedAt` datetime(3)  ,
`accTime` int  NOT NULL ,
UNIQUE INDEX `TotalAccTime.userId_unique`(`userId`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `Profile` ADD FOREIGN KEY (`userId`) REFERENCES `pushuser`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `WorkOut` ADD FOREIGN KEY (`userId`) REFERENCES `pushuser`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Mission` ADD FOREIGN KEY (`workOutId`) REFERENCES `pushuser`.`WorkOut`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `Mission` ADD FOREIGN KEY (`userId`) REFERENCES `pushuser`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201017033209-init-push-db
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,105 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "mysql"
+  url = "***"
+}
+
+model Profile {
+  id                Int                 @default(autoincrement()) @id
+  socialId          String? 
+  authType          AuthType? 
+  userId            Int                 @unique
+  User              User                @relation(fields: [userId], references: [id])
+}   
+    
+model User {    
+  id                Int                 @default(autoincrement()) @id
+  email             String?             @unique
+  password          String?       
+  name              String?       
+  photoURL          String?    
+  birthday          DateTime?       
+  gender            Gender?       
+  createdAt         DateTime?           @default(now())
+  updatedAt         DateTime?           @default(now()) @updatedAt
+  deletedAt         DateTime?
+  lastSignedIn      DateTime?
+  profile           Profile?
+}
+
+model WorkOut {
+  id                Int                 @default(autoincrement()) @id
+  name              String? 
+  workOutType       MissionType?
+  reps              Int?
+  time              Int?
+  set               Int?
+  rest              Int?
+  createdAt         DateTime?           @default(now())
+  updatedAt         DateTime?           @default(now()) @updatedAt
+  deletedAt         DateTime?
+  userId            Int                 @unique
+  User              User                @relation(fields: [userId], references: [id])
+}   
+
+model Mission {
+  id                Int                 @default(autoincrement()) @id
+  createdAt         DateTime?           @default(now())
+  missionType       MissionType
+  workOutId         Int?                @unique
+  WorkOut           WorkOut?            @relation(fields: [workOutId], references: [id])
+  userId            Int                 @unique
+  User              User                @relation(fields: [userId], references: [id])
+}
+
+model WeeklyCount {
+  userId            Int                 @unique
+  createdAt         DateTime?
+  count             Int  
+}
+
+model TotalCount {
+  userId            Int                 @unique
+  createdAt         DateTime?           @default(now())
+  deletedAt         DateTime?
+  count             Int  
+}
+
+model WeeklyAccTime {
+  userId            Int                 @unique
+  createdAt         DateTime?
+  accTime           Int  
+}
+
+model TotalAccTime {
+  userId            Int                 @unique
+  createdAt         DateTime?           @default(now())
+  deletedAt         DateTime?
+  accTime           Int
+}
+
+enum Gender {
+  male
+  female
+}
+
+enum AuthType {
+  email
+  google
+  apple
+}
+
+enum MissionType {
+  workout
+}
+
+enum WorkOutType {
+  tabata
+  static
+  setreps
+  maxreps
+  workOutTime
+}
```


