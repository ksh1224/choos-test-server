# Migration `20201107034638-rename-achievement`

This migration has been generated by 권수현 at 11/7/2020, 12:46:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX `User.email_unique` ON `User`

ALTER TABLE `WeeklyAccTime` DROP FOREIGN KEY `WeeklyAccTime_ibfk_1`

ALTER TABLE `WeeklyCount` DROP FOREIGN KEY `WeeklyCount_ibfk_1`

ALTER TABLE `Mission` DROP FOREIGN KEY `Mission_ibfk_2`

ALTER TABLE `Mission` DROP FOREIGN KEY `Mission_ibfk_1`

ALTER TABLE `Mission` DROP COLUMN `createdAt`,
    DROP COLUMN `missionType`,
    DROP COLUMN `workOutId`,
    DROP COLUMN `userId`,
    ADD COLUMN `title` varchar(191)  ,
    ADD COLUMN `discription` varchar(191)  ,
    ADD COLUMN `reward` varchar(191)  ,
    ADD COLUMN `startAt` datetime(3)  ,
    ADD COLUMN `endAt` datetime(3)  ,
    ADD COLUMN `winnerId` int  

ALTER TABLE `TotalAccTime` ADD COLUMN `id` int  NOT NULL  AUTO_INCREMENT,
    MODIFY `accTime` int,
    ADD PRIMARY KEY (`id`)

ALTER TABLE `TotalCount` ADD COLUMN `id` int  NOT NULL  AUTO_INCREMENT,
    MODIFY `count` int,
    ADD PRIMARY KEY (`id`)

ALTER TABLE `User` DROP COLUMN `email`,
    ADD COLUMN `phoneNumber` varchar(191)  

ALTER TABLE `WorkOut` DROP COLUMN `workOutType`,
    ADD COLUMN `missionType` ENUM('tabata', 'static', 'setreps', 'maxreps', 'workOutTime', 'totalCount', 'totalAccTime')  ,
    MODIFY `userId` int

CREATE TABLE `Achievement` (
`id` int  NOT NULL  AUTO_INCREMENT,
`percent` int  ,
`userId` int  NOT NULL ,
`missionId` int  NOT NULL ,
UNIQUE INDEX `Achievement.userId_unique`(`userId`),
UNIQUE INDEX `Achievement.missionId_unique`(`missionId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Condition` (
`id` int  NOT NULL  AUTO_INCREMENT,
`missionType` ENUM('tabata', 'static', 'setreps', 'maxreps', 'workOutTime', 'totalCount', 'totalAccTime')  ,
`value` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_ConditionToMission` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_ConditionToMission_AB_unique`(`A`,
`B`),
INDEX `_ConditionToMission_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

DROP TABLE `WeeklyAccTime`

DROP TABLE `WeeklyCount`

CREATE UNIQUE INDEX `Mission.winnerId_unique` ON `Mission`(`winnerId`)

CREATE UNIQUE INDEX `User.phoneNumber_unique` ON `User`(`phoneNumber`)

ALTER TABLE `Achievement` ADD FOREIGN KEY (`userId`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Achievement` ADD FOREIGN KEY (`missionId`) REFERENCES `Mission`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_ConditionToMission` ADD FOREIGN KEY (`A`) REFERENCES `Condition`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_ConditionToMission` ADD FOREIGN KEY (`B`) REFERENCES `Mission`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Mission` ADD FOREIGN KEY (`winnerId`) REFERENCES `User`(`id`) ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201107033101-update-camelcase..20201107034638-rename-achievement
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 model Profile {
   id                Int                 @default(autoincrement()) @id
@@ -34,9 +34,9 @@
   totalAccTime      TotalAccTime?
   workOuts          WorkOut[]
   missions          Mission[]
-  achieves          Achieve[]
+  achievements      Achievement[]
 }
 model Mission {
   id                Int                 @default(autoincrement()) @id
@@ -48,9 +48,9 @@
   winnerId          Int?                 @unique
   winner            User?                @relation(fields: [winnerId], references: [id])
-  achieves          Achieve[]
+  achieves          Achievement[]
   conditions        Condition[]
 }
 model WorkOut {
@@ -68,9 +68,9 @@
   userId            Int?                 @unique
   user              User?                @relation(fields: [userId], references: [id])
 }
-model Achieve {
+model Achievement {
   id                Int                 @default(autoincrement()) @id
   percent           Int?
   userId            Int                 @unique
```


